<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="知识付费网盘，提供优质资源下载">
    <meta name="keywords" content="知识付费,网盘,资源下载,学习资料">
    <title>知识付费网盘 - 优质资源分享平台</title>
    <link href="https://jsd.onmicrosoft.cn/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .file-card {
            transition: all 0.3s ease;
        }
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-indigo-600">知识付费网盘</h1>
                    <span class="ml-2 text-gray-500 text-sm">优质资源分享平台</span>
                </div>
                <div class="flex space-x-4">
                    <a href="/dist/login.html" class="text-gray-600 hover:text-indigo-600 transition">
                        <i class="fas fa-sign-in-alt mr-1"></i> 登录
                    </a>
                    <a href="/dist/register.html" class="text-gray-600 hover:text-indigo-600 transition">
                        <i class="fas fa-user-plus mr-1"></i> 注册
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <section class="mb-12">
            <div class="bg-indigo-600 rounded-lg shadow-lg p-8 text-white">
                <h2 class="text-3xl font-bold mb-4">欢迎使用知识付费网盘</h2>
                <p class="text-xl mb-6">这里汇集了各类优质学习资源，助力您的学习与成长</p>
                <div class="flex space-x-4">
                    <a href="#recent-files" class="bg-white text-indigo-600 px-6 py-2 rounded-lg font-medium hover:bg-gray-100 transition">
                        浏览资源
                    </a>
                    <a href="/dist/login.html" class="bg-indigo-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-indigo-400 transition">
                        立即登录
                    </a>
                </div>
            </div>
        </section>

        <section id="recent-files" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">最近上传的资源</h2>
                <div class="flex items-center">
                    <span id="total-count" class="text-gray-500 mr-4">加载中...</span>
                    <button id="refresh-btn" class="text-indigo-600 hover:text-indigo-800 transition">
                        <i class="fas fa-sync-alt"></i> 刷新
                    </button>
                </div>
            </div>

            <div id="files-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- 骨架屏 -->
                <div class="file-card bg-white rounded-lg shadow p-6">
                    <div class="skeleton h-4 w-3/4 mb-4 rounded"></div>
                    <div class="skeleton h-3 w-full mb-2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 mb-4 rounded"></div>
                    <div class="skeleton h-8 w-full rounded"></div>
                </div>
                <div class="file-card bg-white rounded-lg shadow p-6">
                    <div class="skeleton h-4 w-3/4 mb-4 rounded"></div>
                    <div class="skeleton h-3 w-full mb-2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 mb-4 rounded"></div>
                    <div class="skeleton h-8 w-full rounded"></div>
                </div>
                <div class="file-card bg-white rounded-lg shadow p-6">
                    <div class="skeleton h-4 w-3/4 mb-4 rounded"></div>
                    <div class="skeleton h-3 w-full mb-2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 mb-4 rounded"></div>
                    <div class="skeleton h-8 w-full rounded"></div>
                </div>
                <div class="file-card bg-white rounded-lg shadow p-6">
                    <div class="skeleton h-4 w-3/4 mb-4 rounded"></div>
                    <div class="skeleton h-3 w-full mb-2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 mb-4 rounded"></div>
                    <div class="skeleton h-8 w-full rounded"></div>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button id="load-more" class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-indigo-500 transition hidden">
                    加载更多
                </button>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">为什么选择我们？</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="text-indigo-600 text-4xl mb-4">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">安全可靠</h3>
                    <p class="text-gray-600">所有资源经过严格审核，确保内容安全可靠，无病毒、无广告。</p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="text-indigo-600 text-4xl mb-4">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">高速下载</h3>
                    <p class="text-gray-600">采用先进的分发技术，确保您能够高速、稳定地下载所需资源。</p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="text-indigo-600 text-4xl mb-4">
                        <i class="fas fa-gem"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">优质内容</h3>
                    <p class="text-gray-600">精选各类优质学习资源，涵盖多个领域，满足您的学习需求。</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">关于我们</h3>
                    <p class="text-gray-400">知识付费网盘是一个专注于优质资源分享的平台，致力于为用户提供高质量的学习资料。</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">快速链接</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">首页</a></li>
                        <li><a href="/dist/login.html" class="text-gray-400 hover:text-white transition">登录</a></li>
                        <li><a href="/dist/register.html" class="text-gray-400 hover:text-white transition">注册</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">联系我们</h3>
                    <ul class="space-y-2">
                        <li class="flex items-center"><i class="fas fa-envelope mr-2 text-gray-400"></i> <a href="mailto:support@example.com" class="text-gray-400 hover:text-white transition">support@example.com</a></li>
                        <li class="flex items-center"><i class="fas fa-phone mr-2 text-gray-400"></i> <span class="text-gray-400">+86 123 4567 8901</span></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2023 知识付费网盘. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <script>
        // 全局变量
        let offset = 0;
        const limit = 12;
        let hasMore = true;
        let isLoading = false;

        // 获取DOM元素
        const filesContainer = document.getElementById('files-container');
        const loadMoreBtn = document.getElementById('load-more');
        const refreshBtn = document.getElementById('refresh-btn');
        const totalCountEl = document.getElementById('total-count');

        // 页面加载完成后获取最近文件
        document.addEventListener('DOMContentLoaded', () => {
            loadRecentFiles();

            // 添加加载更多按钮事件
            loadMoreBtn.addEventListener('click', () => {
                if (!isLoading && hasMore) {
                    offset += limit;
                    loadRecentFiles(true);
                }
            });

            // 添加刷新按钮事件
            refreshBtn.addEventListener('click', () => {
                offset = 0;
                hasMore = true;
                filesContainer.innerHTML = getSkeletonHTML();
                loadMoreBtn.classList.add('hidden');
                loadRecentFiles();
            });
        });

        // 加载最近文件
        function loadRecentFiles(append = false) {
            if (isLoading) return;
            isLoading = true;

            fetch(`/api/files/recent?limit=${limit}&offset=${offset}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('网络请求失败');
                    }
                    return response.json();
                })
                .then(data => {
                    // 更新总数显示
                    totalCountEl.textContent = `共 ${data.length > 0 ? data[0].id : 0} 个资源`;

                    // 如果没有更多数据
                    if (data.length === 0) {
                        hasMore = false;
                        loadMoreBtn.classList.add('hidden');
                        
                        if (offset === 0) {
                            filesContainer.innerHTML = `
                                <div class="col-span-full text-center py-12">
                                    <i class="fas fa-folder-open text-gray-300 text-5xl mb-4"></i>
                                    <p class="text-gray-500 text-xl">暂无资源</p>
                                </div>
                            `;
                        }
                        return;
                    }

                    // 显示加载更多按钮
                    if (data.length === limit) {
                        loadMoreBtn.classList.remove('hidden');
                    } else {
                        hasMore = false;
                        loadMoreBtn.classList.add('hidden');
                    }

                    // 清空容器或追加内容
                    if (!append) {
                        filesContainer.innerHTML = '';
                    }

                    // 渲染文件卡片
                    data.forEach(file => {
                        const fileCard = createFileCard(file);
                        filesContainer.appendChild(fileCard);
                    });
                })
                .catch(error => {
                    console.error('获取文件列表失败:', error);
                    if (!append) {
                        filesContainer.innerHTML = `
                            <div class="col-span-full text-center py-12">
                                <i class="fas fa-exclamation-triangle text-yellow-500 text-5xl mb-4"></i>
                                <p class="text-gray-500 text-xl">加载失败，请稍后重试</p>
                            </div>
                        `;
                    }
                })
                .finally(() => {
                    isLoading = false;
                });
        }

        // 创建文件卡片
        function createFileCard(file) {
            const div = document.createElement('div');
            div.className = 'file-card bg-white rounded-lg shadow p-6';

            // 获取文件图标
            const fileIcon = getFileIcon(file.contentType);

            // 格式化文件大小
            const fileSize = formatFileSize(file.size);

            // 格式化上传时间
            const uploadTime = new Date(file.uploadedAt).toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });

            div.innerHTML = `
                <div class="flex items-start mb-4">
                    <div class="text-3xl text-indigo-500 mr-3">
                        <i class="${fileIcon}"></i>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <h3 class="text-lg font-semibold text-gray-800 truncate" title="${file.name}">${file.name}</h3>
                        <p class="text-sm text-gray-500">${fileSize} · ${uploadTime}</p>
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-indigo-600 font-medium">${file.pointConfig?.points || 0} 积分</span>
                    <a href="/dist/login.html?redirect=/api/download?path=${encodeURIComponent(file.path)}" class="bg-indigo-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-indigo-500 transition">
                        下载
                    </a>
                </div>
            `;

            return div;
        }

        // 获取文件图标
        function getFileIcon(contentType) {
            if (!contentType) return 'fas fa-file';

            if (contentType.includes('image')) {
                return 'fas fa-file-image';
            } else if (contentType.includes('video')) {
                return 'fas fa-file-video';
            } else if (contentType.includes('audio')) {
                return 'fas fa-file-audio';
            } else if (contentType.includes('pdf')) {
                return 'fas fa-file-pdf';
            } else if (contentType.includes('word') || contentType.includes('document')) {
                return 'fas fa-file-word';
            } else if (contentType.includes('excel') || contentType.includes('spreadsheet')) {
                return 'fas fa-file-excel';
            } else if (contentType.includes('powerpoint') || contentType.includes('presentation')) {
                return 'fas fa-file-powerpoint';
            } else if (contentType.includes('zip') || contentType.includes('rar') || contentType.includes('tar') || contentType.includes('compressed')) {
                return 'fas fa-file-archive';
            } else if (contentType.includes('text')) {
                return 'fas fa-file-alt';
            } else if (contentType.includes('code') || contentType.includes('javascript') || contentType.includes('html') || contentType.includes('css')) {
                return 'fas fa-file-code';
            }

            return 'fas fa-file';
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 获取骨架屏HTML
        function getSkeletonHTML() {
            return `
                <div class="file-card bg-white rounded-lg shadow p-6">
                    <div class="skeleton h-4 w-3/4 mb-4 rounded"></div>
                    <div class="skeleton h-3 w-full mb-2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 mb-4 rounded"></div>
                    <div class="skeleton h-8 w-full rounded"></div>
                </div>
                <div class="file-card bg-white rounded-lg shadow p-6">
                    <div class="skeleton h-4 w-3/4 mb-4 rounded"></div>
                    <div class="skeleton h-3 w-full mb-2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 mb-4 rounded"></div>
                    <div class="skeleton h-8 w-full rounded"></div>
                </div>
                <div class="file-card bg-white rounded-lg shadow p-6">
                    <div class="skeleton h-4 w-3/4 mb-4 rounded"></div>
                    <div class="skeleton h-3 w-full mb-2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 mb-4 rounded"></div>
                    <div class="skeleton h-8 w-full rounded"></div>
                </div>
                <div class="file-card bg-white rounded-lg shadow p-6">
                    <div class="skeleton h-4 w-3/4 mb-4 rounded"></div>
                    <div class="skeleton h-3 w-full mb-2 rounded"></div>
                    <div class="skeleton h-3 w-2/3 mb-4 rounded"></div>
                    <div class="skeleton h-8 w-full rounded"></div>
                </div>
            `;
        }
    </script>
</body>
</html>